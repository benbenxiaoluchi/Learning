/**
 * An Angular module that gives you access to the browsers local storage
 * @version v0.1.5 - 2014-11-04
 * @link https://github.com/grevory/angular-local-storage
 * @author grevory <greg@gregpike.ca>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(n,t){"use strict";function c(n){return/^-?\d+\.?\d*$/.test(n.replace(/["']/g,""))}var o=t.isDefined,f=t.isUndefined,s=t.isNumber,i=t.isObject,r=t.isArray,h=t.extend,u=t.toJson,e=t.fromJson,l=t.module("LocalStorageModule",[]);l.provider("localStorageService",function(){this.prefix="ls";this.storageType="localStorage";this.cookie={expiry:30,path:"/"};this.notify={setItem:!0,removeItem:!1};this.setPrefix=function(n){return this.prefix=n,this};this.setStorageType=function(n){return this.storageType=n,this};this.setStorageCookie=function(n,t){return this.cookie={expiry:n,path:t},this};this.setStorageCookieDomain=function(n){return this.cookie.domain=n,this};this.setNotify=function(n,t){return this.notify={setItem:n,removeItem:t},this};this.$get=["$rootScope","$window","$document","$parse",function(n,t,l,a){var y=this,v=y.prefix,d=y.cookie,nt=y.notify,k=y.storageType,p;l?l[0]&&(l=l[0]):l=document;v.substr(-1)!=="."&&(v=!v?"":v+".");var b=function(n){return v+n},w=function(){try{var i=k in t&&t[k]!==null,r=b("__"+Math.round(Math.random()*1e7));return i&&(p=t[k],p.setItem(r,""),p.removeItem(r)),i}catch(u){return k="cookie",n.$broadcast("LocalStorageModule.notification.error",u.message),!1}}(),it=function(t,e){if(f(e)?e=null:(i(e)||r(e)||s(+e||e))&&(e=u(e)),!w||y.storageType==="cookie")return w||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),nt.setItem&&n.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:e,storageType:"cookie"}),g(t,e);try{(i(e)||r(e))&&(e=u(e));p&&p.setItem(b(t),e);nt.setItem&&n.$broadcast("LocalStorageModule.notification.setitem",{key:t,newvalue:e,storageType:y.storageType})}catch(o){return n.$broadcast("LocalStorageModule.notification.error",o.message),g(t,e)}return!0},ft=function(t){if(!w||y.storageType==="cookie")return w||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),ot(t);var i=p?p.getItem(b(t)):null;return!i||i==="null"?null:i.charAt(0)==="{"||i.charAt(0)==="["||c(i)?e(i):i},et=function(t){if(!w||y.storageType==="cookie")return w||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),nt.removeItem&&n.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:"cookie"}),tt(t);try{p.removeItem(b(t));nt.removeItem&&n.$broadcast("LocalStorageModule.notification.removeitem",{key:t,storageType:y.storageType})}catch(i){return n.$broadcast("LocalStorageModule.notification.error",i.message),tt(t)}return!0},st=function(){var t,i,r;if(!w)return n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),!1;t=v.length;i=[];for(r in p)if(r.substr(0,t)===v)try{i.push(r.substr(t))}catch(u){return n.$broadcast("LocalStorageModule.notification.error",u.Description),[]}return i},ht=function(t){var r,u,f,i;if(t=t||"",r=v.slice(0,-1),u=new RegExp(r+"."+t),!w||y.storageType==="cookie")return w||n.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),ut();f=v.length;for(i in p)if(u.test(i))try{et(i.substr(f))}catch(e){return n.$broadcast("LocalStorageModule.notification.error",e.message),ut()}return!0},rt=function(){try{return t.navigator.cookieEnabled||"cookie"in l&&(l.cookie.length>0||(l.cookie="test").indexOf.call(l.cookie,"test")>-1)}catch(i){return n.$broadcast("LocalStorageModule.notification.error",i.message),!1}}(),g=function(t,e){var c;if(f(e))return!1;if((r(e)||i(e))&&(e=u(e)),!rt)return n.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;try{var s="",o=new Date,h="";e===null?(o.setTime(o.getTime()+-864e5),s="; expires="+o.toGMTString(),e=""):d.expiry!==0&&(o.setTime(o.getTime()+d.expiry*864e5),s="; expires="+o.toGMTString());!t||(c="; path="+d.path,d.domain&&(h="; domain="+d.domain),l.cookie=b(t)+"="+encodeURIComponent(e)+s+c+h)}catch(a){return n.$broadcast("LocalStorageModule.notification.error",a.message),!1}return!0},ot=function(t){var u,r,i,f,o;if(!rt)return n.$broadcast("LocalStorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(u=l.cookie&&l.cookie.split(";")||[],r=0;r<u.length;r++){for(i=u[r];i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(b(t)+"=")===0){f=decodeURIComponent(i.substring(v.length+t.length+1,i.length));try{return o=JSON.parse(f),e(o)}catch(s){return f}}}return null},tt=function(n){g(n,null)},ut=function(){for(var r,n=null,u=v.length,i=l.cookie.split(";"),t=0;t<i.length;t++){for(n=i[t];n.charAt(0)===" ";)n=n.substring(1,n.length);r=n.substring(u,n.indexOf("="));tt(r)}},ct=function(){return k},lt=function(n,t,r,u){u=u||t;var f=ft(u);return f===null&&o(r)?f=r:i(f)&&i(r)&&(f=h(r,f)),a(t).assign(n,f),n.$watch(t,function(n){it(u,n)},i(n[t]))},at=function(){for(var i=0,r=t[k],n=0;n<r.length;n++)r.key(n).indexOf(v)===0&&i++;return i},vt=function(n){v=n};return{isSupported:w,getStorageType:ct,set:it,changePrefix:vt,add:it,get:ft,keys:st,remove:et,clearAll:ht,bind:lt,deriveKey:b,length:at,cookie:{isSupported:rt,set:g,add:g,get:ot,remove:tt,clearAll:ut}}}]})})(window,window.angular);
//# sourceMappingURL=angular-local-storage.min.js.map
